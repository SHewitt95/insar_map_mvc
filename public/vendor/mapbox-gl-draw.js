!function t(e,o,r){function n(a,s){if(!o[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=o[a]={exports:{}};e[a][0].call(l.exports,function(t){var o=e[a][1][t];return n(o?o:t)},l,l.exports,t,e,o,r)}return o[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)n(r[a]);return n}({1:[function(t,e,o){"use strict";t("./src/lib/polyfills");var r=t("./src/setup"),n=t("./src/options"),i=t("./src/api"),a=t("./src/lib/types"),s=function(t){t=n(t);var e={options:t},o=i(e);e.api=o;var s=r(e);return o.addTo=s.addTo,o.remove=s.remove,o.types=a,o.options=t,o};e.exports=s,window.mapboxgl=window.mapboxgl||{},window.mapboxgl.Draw=s},{"./src/api":12,"./src/lib/polyfills":22,"./src/lib/types":26,"./src/options":33,"./src/setup":35}],2:[function(t,e,o){var r=e.exports=function(t,e){if(e||(e=16),void 0===t&&(t=128),0>=t)return"0";for(var o=Math.log(Math.pow(2,t))/Math.log(e),n=2;o===1/0;n*=2)o=Math.log(Math.pow(2,t/n))/Math.log(e)*n;for(var i=o-Math.floor(o),a="",n=0;n<Math.floor(o);n++){var s=Math.floor(Math.random()*e).toString(e);a=s+a}if(i){var u=Math.pow(e,i),s=Math.floor(Math.random()*u).toString(e);a=s+a}var c=parseInt(a,e);return c!==1/0&&c>=Math.pow(2,t)?r(t,e):a};r.rack=function(t,e,o){var n=function(n){var a=0;do{if(a++>10){if(!o)throw new Error("too many ID collisions, use more bits");t+=o}var s=r(t,e)}while(Object.hasOwnProperty.call(i,s));return i[s]=n,s},i=n.hats={};return n.get=function(t){return n.hats[t]},n.set=function(t,e){return n.hats[t]=e,n},n.bits=t||128,n.base=e||16,n}},{}],3:[function(t,e,o){"use strict";function r(t,e){this.x=t,this.y=e}e.exports=r,r.prototype={clone:function(){return new r(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,o=t.y-this.y;return e*e+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,o=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),o=Math.sin(t),r=e*this.x-o*this.y,n=o*this.x+e*this.y;return this.x=r,this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(t){return t instanceof r?t:Array.isArray(t)?new r(t[0],t[1]):t}},{}],4:[function(t,e,o){var r=t("turf-meta").coordEach,n=t("turf-point");e.exports=function(t){var e=0,o=0,i=0;return r(t,function(t){e+=t[0],o+=t[1],i++},!0),n([e/i,o/i])}},{"turf-meta":5,"turf-point":6}],5:[function(t,e,o){function r(t,e,o){var r,n,i,a,s,u,c,p,d,f=0,h="FeatureCollection"===t.type,y="Feature"===t.type,m=h?t.features.length:1;for(r=0;m>r;r++)for(p=h?t.features[r].geometry:y?t.geometry:t,d="GeometryCollection"===p.type,u=d?p.geometries.length:1,a=0;u>a;a++)if(s=d?p.geometries[a]:p,c=s.coordinates,f=!o||"Polygon"!==s.type&&"MultiPolygon"!==s.type?0:1,"Point"===s.type)e(c);else if("LineString"===s.type||"MultiPoint"===s.type)for(n=0;n<c.length;n++)e(c[n]);else if("Polygon"===s.type||"MultiLineString"===s.type)for(n=0;n<c.length;n++)for(i=0;i<c[n].length-f;i++)e(c[n][i]);else{if("MultiPolygon"!==s.type)throw new Error("Unknown Geometry Type");for(n=0;n<c.length;n++)for(i=0;i<c[n].length;i++)for(l=0;l<c[n][i].length-f;l++)e(c[n][i][l])}}function n(t,e,o,n){return r(t,function(t){o=e(o,t)},n),o}function i(t,e){var o;switch(t.type){case"FeatureCollection":for(features=t.features,o=0;o<t.features.length;o++)e(t.features[o].properties);break;case"Feature":e(t.properties)}}function a(t,e,o){return i(t,function(t){o=e(o,t)}),o}e.exports.coordEach=r,e.exports.coordReduce=n,e.exports.propEach=i,e.exports.propReduce=a},{}],6:[function(t,e,o){var r=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};e.exports=function(t,e){if(!r(t))throw new Error("Coordinates must be an array");if(t.length<2)throw new Error("Coordinates must be at least 2 numbers long");return{type:"Feature",geometry:{type:"Point",coordinates:t},properties:e||{}}}},{}],7:[function(t,e,o){var r=t("turf-extent"),n=t("turf-bbox-polygon");e.exports=function(t,e){var o=r(t),i=n(o);return i}},{"turf-bbox-polygon":8,"turf-extent":10}],8:[function(t,e,o){var r=t("turf-polygon");e.exports=function(t){var e=[t[0],t[1]],o=[t[0],t[3]],n=[t[2],t[3]],i=[t[2],t[1]],a=r([[e,i,n,o,e]]);return a}},{"turf-polygon":9}],9:[function(t,e,o){e.exports=function(t,e){if(null===t)throw new Error("No coordinates passed");for(var o=0;o<t.length;o++)for(var r=t[o],n=0;n<r[r.length-1].length;n++){if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(r[r.length-1][n]!==r[0][n])throw new Error("First and last Position are not equivalent.")}var i={type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:e};return i.properties||(i.properties={}),i}},{}],10:[function(t,e,o){var r=t("turf-meta").coordEach;e.exports=function(t){var e=[1/0,1/0,-(1/0),-(1/0)];return r(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}},{"turf-meta":11}],11:[function(t,e,o){arguments[4][5][0].apply(o,arguments)},{dup:5}],12:[function(t,e,o){"use strict";var r=t("hat"),n={Polygon:t("./feature_types/polygon"),LineString:t("./feature_types/line_string"),Point:t("./feature_types/point")};e.exports=function(t){return{add:function(e){var o=this;if("FeatureCollection"===e.type)return e.features.map(function(t){return o.add(t)});if(e=JSON.parse(JSON.stringify(e)),e.geometry||(e={type:"Feature",id:e.id,properties:e.properties||{},geometry:e}),e.id=e.id||r(),t.store.needsUpdate(e)){var i=n[e.geometry.type];if(void 0===i)throw new Error("Invalid feature type. Must be Point, Polygon or LineString");var a=new i(t,e);t.store.add(a),t.store.render()}else{var s=t.store.get(e.id);s.properties=e.properties}return e.id},get:function(e){var o=t.store.get(e);return o?o.toGeoJSON():void 0},getAll:function(){return{type:"FeatureCollection",features:t.store.getAll().map(function(t){return t.toGeoJSON()})}},"delete":function(e){t.store["delete"]([e]),t.store.render()},deleteAll:function(){t.store["delete"](t.store.getAll().map(function(t){return t.id})),t.store.render()},changeMode:function(e,o){t.events.changeMode(e,o)},trash:function(){t.events.fire("trash")}}}},{"./feature_types/line_string":15,"./feature_types/point":16,"./feature_types/polygon":17,hat:2}],13:[function(t,e,o){"use strict";var r=t("./lib/mode_handler"),n=t("./lib/find_target_at"),i={simple_select:t("./modes/simple_select"),direct_select:t("./modes/direct_select"),draw_point:t("./modes/draw_point"),draw_line_string:t("./modes/draw_line_string"),draw_polygon:t("./modes/draw_polygon")};e.exports=function(t){var e=!1,o={},a="simple_select",s=r(i.simple_select(t),t);o.drag=function(e){t.ui.setClass({mouse:"drag"}),s.drag(e)},o.click=function(e){var o=n(e,t);e.featureTarget=o,s.click(e)},o.doubleclick=function(e){var o=n(e,t);e.featureTarget=o,s.doubleclick(e)},o.mousemove=function(r){if(e)o.drag(r);else{var i=n(r,t);r.featureTarget=i,s.mousemove(r)}},o.mousedown=function(o){e=!0;var r=n(o,t);o.featureTarget=r,s.mousedown(o)},o.mouseup=function(o){e=!1;var r=n(o,t);o.featureTarget=r,s.mouseup(o)},o.trash=function(){s.trash()};var u=function(t){return!(8===t||t>=48&&57>=t)};o.keydown=function(e){8===e.keyCode?(e.preventDefault(),c.fire("trash")):u(e.keyCode)?s.keydown(e):49===e.keyCode?t.api.changeMode("draw_point"):50===e.keyCode?t.api.changeMode("draw_line_string"):51===e.keyCode&&t.api.changeMode("draw_polygon")},o.keyup=function(t){u(t.keyCode)&&s.keyup(t)},o.deleted=function(){t.store.setDirty()},o.zoomend=function(){t.store.changeZoom()};var c={currentModeName:function(){return a},currentModeRender:function(t,e){return s.render(t,e)},changeMode:function(e,o){s.stop();var n=i[e];if(void 0===n)throw new Error(e+" is not valid");a=e;var u=n(t,o);s=r(u,t),t.map.fire("draw.modechange",{mode:e,opts:o}),t.store.setDirty(),t.store.render()},fire:function(t,e){o[t]&&o[t](e)},addEventListeners:function(){t.map.on("click",o.click),t.map.on("dblclick",o.doubleclick),t.map.on("mousemove",o.mousemove),t.map.on("mousedown",o.mousedown),t.map.on("mouseup",o.mouseup),t.container.addEventListener("keydown",o.keydown),t.container.addEventListener("keyup",o.keyup),t.map.on("draw.deleted",o.deleted),t.map.on("zoomend",o.zoomend)},removeEventListeners:function(){t.map.off("click",o.click),t.map.off("dblclick",o.doubleclick),t.map.off("mousemove",o.mousemove),t.map.off("mousedown",o.mousedown),t.map.off("mouseup",o.mouseup),t.container.removeEventListener("keydown",o.keydown),t.container.removeEventListener("keyup",o.keyup),t.map.off("draw.deleted",o.deleted),t.map.off("zoomend",o.zoomend)}};return c}},{"./lib/find_target_at":20,"./lib/mode_handler":21,"./modes/direct_select":28,"./modes/draw_line_string":29,"./modes/draw_point":30,"./modes/draw_polygon":31,"./modes/simple_select":32}],14:[function(t,e,o){"use strict";var r=t("hat"),n=function(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||r(),this.type=e.geometry.type,t.store.add(this)};n.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},n.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:"Feature",properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},n.prototype.internal=function(t){return{type:"Feature",properties:{id:this.id,meta:"feature","meta:type":this.type,active:"false",mode:t},geometry:{coordinates:this.getCoordinates(),type:this.type}}},e.exports=n},{hat:2}],15:[function(t,e,o){"use strict";var r=t("./feature"),n=function(t,e){r.call(this,t,e)};n.prototype=Object.create(r.prototype),n.prototype.isValid=function(){return this.coordinates.length>1},n.prototype.addCoordinate=function(t,e,o){this.selectedCoords={};var r=parseInt(t,10);this.coordinates.splice(r,0,[e,o])},n.prototype.getCoordinate=function(t){var e=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[e]))},n.prototype.removeCoordinate=function(t){this.coordinates.splice(parseInt(t,10),1)},n.prototype.updateCoordinate=function(t,e,o){var r=parseInt(t,10);this.coordinates[r]=[e,o]},e.exports=n},{"./feature":14}],16:[function(t,e,o){"use strict";var r=t("./feature"),n=function(t,e){r.call(this,t,e)};n.prototype=Object.create(r.prototype),n.prototype.isValid=function(){return"number"==typeof this.coordinates[0]},n.prototype.updateCoordinate=function(t,e,o){this.coordinates=[e,o]},e.exports=n},{"./feature":14}],17:[function(t,e,o){"use strict";var r=t("./feature"),n=function(t,e){r.call(this,t,e),this.coordinates=this.coordinates.map(function(t){return t.slice(0,-1)})};n.prototype=Object.create(r.prototype),n.prototype.isValid=function(){return this.coordinates.every(function(t){return t.length>2})},n.prototype.addCoordinate=function(t,e,o){var r=t.split(".").map(function(t){return parseInt(t,10)}),n=this.coordinates[r[0]];n.splice(r[1],0,[e,o])},n.prototype.removeCoordinate=function(t){var e=t.split(".").map(function(t){return parseInt(t,10)}),o=this.coordinates[e[0]];o&&(o.splice(e[1],1),o.length<3&&this.coordinates.splice(e[0],1))},n.prototype.getCoordinate=function(t){var e=t.split(".").map(function(t){return parseInt(t,10)}),o=this.coordinates[e[0]];return JSON.parse(JSON.stringify(o[e[1]]))},n.prototype.getCoordinates=function(){return this.coordinates.map(function(t){return t.concat([t[0]])})},n.prototype.updateCoordinate=function(t,e,o){var r=t.split("."),n=parseInt(r[0],10),i=parseInt(r[1],10);void 0===this.coordinates[n]&&(this.coordinates[n]=[]),this.coordinates[n][i]=[e,o]},e.exports=n},{"./feature":14}],18:[function(t,e,o){"use strict";var r=t("./to_midpoint"),n=t("./to_vertex");e.exports=function(t,e,o,i,a){for(var s=null,u=null,c=null,l=0;l<t.geometry.coordinates.length;l++)if("Polygon"===t.geometry.type){for(var p=t.geometry.coordinates[l],d=0;d<p.length-1;d++){var f=p[d],h=l+"."+d;s=n(t.properties.id,f,h,a.indexOf(h)>-1),c=c?c:s,o(s),d>0&&e&&o(r(t.properties.id,u,s,i)),u=s}e&&o(r(t.properties.id,s,c,i))}else{var y=t.geometry.coordinates[l],m=""+l;s=n(t.properties.id,y,m,a.indexOf(m)>-1),o(s),l>0&&e&&o(r(t.properties.id,u,s,i)),u=s}}},{"./to_midpoint":24,"./to_vertex":25}],19:[function(t,e,o){"use strict";e.exports={isOfMetaType:function(t){return function(e){var o=e.featureTarget;return o?o.properties.meta===t:!1}},noFeature:function(t){return void 0===t.featureTarget},isFeature:function(t){return void 0!==t.featureTarget&&"feature"===t.featureTarget.properties.meta},isShiftDown:function(t){return t.originalEvent.shiftKey===!0},isEscapeKey:function(t){return 27===t.keyCode},isEnterKey:function(t){return 13===t.keyCode}}},{}],20:[function(t,e,o){"use strict";var r=["feature","midpoint","vertex","too-small"],n={Point:3,LineString:2,Polygon:1,midpoint:0,vertex:0,"too-small":0},i=function a(t,e){if(Array.isArray(e[0]))return e.reduce(function(e,o){return e.concat(a(t,o))},[]).sort()[0];var o=Math.abs(t.lng-e[0]),r=Math.abs(t.lat-e[1]);return Math.pow(o*o+r*r,.5)};e.exports=function(t,e){var o=function(e,o){var r="feature"===e.properties.meta?n[e.properties.meta]:n[e.properties["meta:type"]],a="feature"===e.properties.meta?n[o.properties.meta]:n[o.properties["meta:type"]];if(r!==a)return r-a;var s=i(t.lngLat,e.geometry.coordinates),u=i(t.lngLat,o.geometry.coordinates);return u-s},a=.5,s=e.map.queryRenderedFeatures([[t.point.x-a,t.point.y-a],[t.point.x+a,t.point.y+a]],{});if(s=s.filter(function(t){var e=t.properties.meta;return-1!==r.indexOf(e)}),s.sort(o),t.dropPoint===!0){var u=e.map.unproject(t.point);e.api.add({id:"testing",type:"Feature",properties:{},geometry:{type:"Point",coordinates:[u.lng,u.lat]}})}return s[0]?e.ui.setClass({feature:s[0].properties.meta,mouse:"hover"}):e.ui.setClass({mouse:"none"}),s[0]}},{}],21:[function(t,e,o){"use strict";var r=function(t,e){var o={drag:[],click:[],doubleclick:[],mousemove:[],mousedown:[],mouseup:[],keydown:[],keyup:[],trash:[]},r={on:function(t,e,r){if(void 0===o[t])throw new Error("Invalid event type: "+t);o[t].push({selector:e,fn:r})},off:function(t,e,r){o[t]=o[t].filter(function(t){return t.selector!==e||t.fn!==r})},fire:function(t,o){var r=e.events.currentModeName();e.map.fire("draw."+r+"."+t,o)}},n=function(t,n){for(var i=o[t],a=i.length;a--;){var s=i[a];if(s.selector(n)){s.fn.call(r,n),e.store.render();break}}};return t.start.call(r),{render:t.render||function(t){return t},stop:t.stop||function(){},drag:function(t){n("drag",t)},click:function(t){n("click",t)},doubleclick:function(t){n("doubleclick",t)},mousemove:function(t){n("mousemove",t)},mousedown:function(t){n("mousedown",t)},mouseup:function(t){n("mouseup",t)},keydown:function(t){n("keydown",t)},keyup:function(t){n("keyup",t)},trash:function(t){n("trash",t)}}};e.exports=r},{}],22:[function(t,e,o){"use strict";e.exports=function(){"function"!=typeof Object.assign&&!function(){Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),o=1;o<arguments.length;o++){var r=arguments[o];if(void 0!==r&&null!==r)for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}return e}}()}},{}],23:[function(t,e,o){"use strict";e.exports=[{id:"gl-draw-active-line",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FF9800","line-dasharray":[.2,2],"line-width":4},interactive:!0},{id:"gl-draw-active-polygon",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#FF9800","fill-opacity":.25},interactive:!0},{id:"gl-draw-active-polygon-stroke",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FF9800","line-dasharray":[.2,2],"line-width":4},interactive:!0},{id:"gl-draw-point-mid-outline",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":7,"circle-opacity":.65,"circle-color":"#fff"},interactive:!0},{id:"gl-draw-point-mid",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":6,"circle-opacity":.65,"circle-color":"#FF9800"},interactive:!0},{id:"gl-draw-polygon",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"]],paint:{"fill-color":"#03A9F4","fill-outline-color":"#03A9F4","fill-opacity":.25},interactive:!0},{id:"gl-draw-polygon-stroke",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#03A9F4","line-width":3},interactive:!0},{id:"gl-draw-line",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#03A9F4","line-width":3},interactive:!0},{id:"gl-draw-active-point",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":9,"circle-color":"#fff"},interactive:!0},{id:"gl-draw-active-point-highlight",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":7,"circle-color":"#EF6C00"},interactive:!0},{id:"gl-draw-polygon-point-outline",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","vertex"]],paint:{"circle-radius":9,"circle-color":"#fff"},interactive:!0},{id:"gl-draw-polygon-point",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","vertex"]],paint:{"circle-radius":7,"circle-color":"#FF9800"},interactive:!0},{id:"gl-draw-point-point-outline",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":9,"circle-color":"#fff"},interactive:!0},{id:"gl-draw-point",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":7,"circle-color":"#03A9F4"},interactive:!0},{id:"gl-draw-too-small",type:"circle",filter:["all",["==","$type","Point"],["==","meta","too-small"]],paint:{"circle-radius":5,"circle-color":"#037994"},interactive:!0}]},{}],24:[function(t,e,o){"use strict";e.exports=function(t,e,o,r){var n=e.geometry.coordinates,i=o.geometry.coordinates,a=r.project([n[0],n[1]]),s=r.project([i[0],i[1]]),u=r.unproject([(a.x+s.x)/2,(a.y+s.y)/2]);return{type:"Feature",properties:{meta:"midpoint",parent:t,lng:u.lng,lat:u.lat,coord_path:o.properties.coord_path},geometry:{type:"Point",coordinates:[u.lng,u.lat]}}}},{}],25:[function(t,e,o){"use strict";e.exports=function(t,e,o,r){return{type:"Feature",properties:{meta:"vertex",parent:t,coord_path:o,active:""+r},geometry:{type:"Point",coordinates:e}}}},{}],26:[function(t,e,o){"use strict";var r={POLYGON:"polygon",LINE:"line_string",POINT:"point"};e.exports=r},{}],27:[function(t,e,o){"use strict";function r(t){for(var e=0;e<t.length;e++)if(t[e]in s)return t[e]}function n(t,e,o){var r,n,i,a;return a=function(){r=!1,n&&(i.apply(o,n),n=!1)},i=function(){r?n=arguments:(t.apply(o,arguments),setTimeout(a,e),r=!0)}}var i=t("point-geometry"),a={};a.mousePos=function(t,e){var o=e.getBoundingClientRect();return new i(t.clientX-o.left-e.clientLeft,t.clientY-o.top-e.clientTop)},a.create=function(t,e,o,r){var n=document.createElement(t);if(e&&(n.className=e),r)for(var i in r)n.setAttribute(i,r[i]);return o&&o.appendChild(n),n},a.removeClass=function(t,e){Array.prototype.forEach.call(t,function(t){t.classList.remove(e)})};var s=document.documentElement.style,u=r(["transform","WebkitTransform"]);a.setTransform=function(t,e){t.style[u]=e};var c,l=r(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);a.disableSelection=function(){l&&(c=s[l],s[l]="none")},a.enableSelection=function(){l&&(s[l]=c)},e.exports.createButton=function(t,e,o){var r={title:e.title};e.id&&(r.id=e.id);var n=a.create("button",e.className,t,r);return n.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation();var r=t.target;r.classList.contains("active")?r.classList.remove("active"):(a.removeClass(document.querySelectorAll("."+o),"active"),r.classList.add("active"),e.fn())},!0),n},e.exports.translate=function(t,e,o,r){t=JSON.parse(JSON.stringify(t));var n,i,a=o.x-e.x,s=o.y-e.y,u=t.geometry;if("Polygon"===u.type)for(n=u.coordinates[0].length,i=0;n>i;i++)u.coordinates[0][i]=p(u.coordinates[0][i],a,s,r);else if("LineString"===u.type)for(n=u.coordinates.length,i=0;n>i;i++)u.coordinates[i]=p(u.coordinates[i],a,s,r);else u.coordinates=p(u.coordinates,a,s,r);return t};var p=function(t,e,o,r){var n=r.project([t[0],t[1]]);return n=r.unproject([n.x+e,n.y+o]),[n.lng,n.lat]};e.exports.throttle=n,e.exports.DOM=a,e.exports.translatePoint=p},{"point-geometry":3}],28:[function(t,e,o){"use strict";var r=t("../lib/common_selectors"),n=r.noFeature,i=r.isOfMetaType,a=r.isShiftDown,s=t("../lib/add_coords");e.exports=function(t,e){var o=e.featureId,r=t.store.get(o),u=e.isDragging||!1,c=e.startPos||null,l=null,p=null,d=e.coordPath?[e.coordPath]:[],f=function(t){u=!0,c=t.lngLat;var e=t.featureTarget.properties,o=d.indexOf(e.coord_path);a(t)||-1!==o?a(t)&&-1===o&&d.push(e.coord_path):d=[e.coord_path]},h=function(t){u=!0,c=t.lngLat;var e=t.featureTarget.properties;r.addCoordinate(e.coord_path,e.lng,e.lat),d=[e.coord_path]},y=function(){l=d.map(function(t){return r.getCoordinate(t)}),p=l.length};return{start:function(){this.on("mousedown",i("vertex"),f),this.on("mousedown",i("midpoint"),h),this.on("drag",function(){return u},function(t){t.originalEvent.stopPropagation(),null===l&&y();for(var e=t.lngLat.lng-c.lng,o=t.lngLat.lat-c.lat,n=0;p>n;n++){var i=d[n],a=l[n],s=a[0]+e,u=a[1]+o;r.updateCoordinate(i,s,u)}}),this.on("mouseup",function(){return!0},function(){u=!1,l=null,p=null,c=null}),this.on("click",n,function(e){e.originalEvent.stopPropagation(),t.events.changeMode("simple_select")}),this.on("trash",function(){return d.length>0},function(){d.sort().reverse().forEach(function(t){return r.removeCoordinate(t)}),d=[],r.isValid()===!1&&(t.store["delete"]([o]),t.events.changeMode("simple_select"))}),this.on("trash",function(){return 0===d.length},function(){t.events.changeMode("simple_select",[o])})},stop:function(){},render:function(e,r){o===e.properties.id?(e.properties.active="true",r(e),s(e,!0,r,t.map,d)):(e.properties.active="false",r(e))}}}},{"../lib/add_coords":18,"../lib/common_selectors":19}],29:[function(t,e,o){"use strict";var r=t("../lib/common_selectors"),n=r.isEnterKey,i=r.isEscapeKey,a=t("../feature_types/line_string"),s=t("../lib/types");e.exports=function(t){var e=new a(t,{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}}),o=function(){t.events.changeMode("simple_select"),t.store["delete"]([e.id])},r=0,u=function(o){t.ui.setClass({mouse:"add"}),e.updateCoordinate(r,o.lngLat.lng,o.lngLat.lat)},c=function(o){t.ui.setClass({mouse:"add"}),r>0&&e.coordinates[0][0]===o.lngLat.lng&&e.coordinates[0][1]===o.lngLat.lat?l():r>0&&e.coordinates[r-1][0]===o.lngLat.lng&&e.coordinates[r-1][1]===o.lngLat.lat?l():(e.updateCoordinate(r,o.lngLat.lng,o.lngLat.lat),r++)},l=function(){e.removeCoordinate(""+r),r--,t.events.changeMode("simple_select",[e.id])};return{start:function(){t.ui.setClass({mouse:"add"}),t.ui.setButtonActive(s.LINE),this.on("mousemove",function(){return!0},u),this.on("click",function(){return!0},c),this.on("keyup",i,o),this.on("keyup",n,l),this.on("trash",function(){return!0},o)},stop:function(){t.ui.setButtonInactive(s.LINE),e.isValid()||t.store["delete"]([e.id])},render:function(t,o){void 0!==t.geometry.coordinates[0]&&(t.properties.active=t.properties.id===e.id?"true":"false",t.properties.meta="true"===t.properties.active?"feature":t.properties.meta,o(t))}}}},{"../feature_types/line_string":15,"../lib/common_selectors":19,"../lib/types":26}],30:[function(t,e,o){"use strict";var r=t("../lib/common_selectors"),n=r.isEnterKey,i=r.isEscapeKey,a=t("../feature_types/point"),s=t("../lib/types");e.exports=function(t){var e=new a(t,{type:"Feature",properties:{},geometry:{type:"Point",coordinates:[]}}),o=function(){t.events.changeMode("simple_select"),t.store["delete"]([e.id])},r=function(){t.ui.setClass({mouse:"add"})},u=!1,c=function(o){t.ui.setClass({mouse:"add"}),u=!0,e.updateCoordinate("",o.lngLat.lng,o.lngLat.lat),t.events.changeMode("simple_select",[e.id])};return{start:function(){t.ui.setClass({mouse:"add"}),t.ui.setButtonActive(s.POINT),this.on("mousemove",function(){return!0},r),this.on("click",function(){return!0},c),this.on("keyup",i,o),this.on("keyup",n,o),this.on("trash",function(){return!0},o)},stop:function(){t.ui.setButtonInactive(s.POINT),u===!1&&t.store["delete"]([e.id])},render:function(t,o){t.properties.active=t.properties.id===e.id?"true":"false","false"===t.properties.active&&o(t)}}}},{"../feature_types/point":16,"../lib/common_selectors":19,"../lib/types":26}],31:[function(t,e,o){"use strict";var r=t("../lib/common_selectors"),n=r.isEnterKey,i=r.isEscapeKey,a=t("../feature_types/polygon"),s=t("../lib/types");e.exports=function(t){var e=new a(t,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[]]}}),o=function(){t.events.changeMode("simple_select"),t.store["delete"]([e.id])},r=0,u=function(o){t.ui.setClass({mouse:"add"}),e.updateCoordinate("0."+r,o.lngLat.lng,o.lngLat.lat)},c=function(o){t.ui.setClass({mouse:"add"}),r>0&&e.coordinates[0][0][0]===o.lngLat.lng&&e.coordinates[0][0][1]===o.lngLat.lat?l():r>0&&e.coordinates[0][r-1][0]===o.lngLat.lng&&e.coordinates[0][r-1][1]===o.lngLat.lat?l():(e.updateCoordinate("0."+r,o.lngLat.lng,o.lngLat.lat),r++)},l=function(){e.removeCoordinate("0."+r),r--,t.events.changeMode("simple_select",[e.id])};return{start:function(){t.ui.setClass({mouse:"add"}),t.ui.setButtonActive(s.POLYGON),this.on("mousemove",function(){return!0},u),this.on("click",function(){return!0},c),this.on("keyup",i,o),this.on("keyup",n,l),this.on("trash",function(){return!0},o)},stop:function(){t.ui.setButtonInactive(s.POLYGON),e.isValid()||t.store["delete"]([e.id])},render:function(t,o){if(t.properties.active=t.properties.id===e.id?"true":"false",t.properties.meta="true"===t.properties.active?"feature":t.properties.meta,"true"===t.properties.active&&1===r){var n=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];o({type:"Feature",properties:t.properties,geometry:{coordinates:n,type:"LineString"}})}else("false"===t.properties.active||r>1)&&o(t)}}}},{"../feature_types/polygon":17,"../lib/common_selectors":19,"../lib/types":26}],32:[function(t,e,o){"use strict";var r=t("../lib/common_selectors"),n=r.noFeature,i=r.isShiftDown,a=r.isFeature,s=r.isOfMetaType,u=t("../lib/add_coords");e.exports=function(t,e){var o={};(e||[]).forEach(function(e){o[e]=t.store.get(e)});var r=null,c=!1,l=null,p=null,d=null,f=function(t){if(a(t)){var e=t.featureTarget.properties;return void 0!==o[e.id]&&"Point"!==o[e.id].type}return!1},h=function(){var t=Object.keys(o);l=t.map(function(t){return o[t].getCoordinates()}),p=t.map(function(t){return o[t]}),d=t.length},y=function(e){t.api.changeMode("direct_select",{featureId:e.featureTarget.properties.id})};return{start:function(){this.on("click",n,function(){var t=Object.keys(o);o={},this.fire("selected.end",t)}),this.on("mousedown",s("vertex"),function(e){t.api.changeMode("direct_select",{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,isDragging:!0,startPos:e.lngLat})}),this.on("mousedown",s("too-small"),function(e){var o=JSON.parse(e.featureTarget.properties.bounds,{padding:100});t.map.fitBounds(o)}),this.on("mousedown",a,function(e){c=!0,r=e.lngLat;var n=e.featureTarget.properties.id,a=void 0!==o[n];if(a&&!i(e))this.on("mouseup",f,y);else if(a&&i(e))delete o[n],this.fire("selected.end",[n]);else if(!a&&i(e))o[n]=t.store.get(n),this.fire("selected.start",[n]);else{var s=Object.keys(o);o={},o[n]=t.store.get(n),this.fire("selected.end",s),this.fire("selected.start",[n])}}),this.on("mouseup",function(){return!0},function(){c=!1,l=null,p=null,d=null}),this.on("drag",function(){return c},function(t){this.off("mouseup",f,y),t.originalEvent.stopPropagation(),null===l&&h();for(var e=t.lngLat.lng-r.lng,o=t.lngLat.lat-r.lat,n=function(t){return[t[0]+e,t[1]+o]},i=function(t){return t.map(function(t){return[t[0]+e,t[1]+o]})},a=0;d>a;a++){var s=p[a];"Point"===s.type?(s.coordinates[0]=l[a][0]+e,s.coordinates[1]=l[a][1]+o):"LineString"===s.type?s.coordinates=l[a].map(n):"Polygon"===s.type&&(s.coordinates=l[a].map(i))}}),this.on("trash",function(){return!0},function(){c=!1,l=null,p=null,d=null,t.store["delete"](Object.keys(o)),o={}})},render:function(e,r){e.properties.active=o[e.properties.id]?"true":"false","true"===e.properties.active&&u(e,!1,r,t.map,[]),r(e)}}}},{"../lib/add_coords":18,"../lib/common_selectors":19}],33:[function(t,e,o){"use strict";var r=t("hat"),n={defaultMode:"simple_select",position:"top-left",keybindings:!0,displayControlsDefault:!0,styles:t("./lib/theme"),controls:{}},i={point:!0,line_string:!0,polygon:!0,trash:!0},a={point:!1,line_string:!1,polygon:!1,trash:!1};e.exports=function(){var t=arguments.length<=0||void 0===arguments[0]?{controls:{}}:arguments[0];return t.displayControlsDefault===!1?t.controls=Object.assign(a,t.controls):t.controls=Object.assign(i,t.controls),t=Object.assign(n,t),t.styles=t.styles.reduce(function(t,e){if(e.id=e.id||r(),e.source)t.push(e);else{var o=e.id;e.id=o+".hot",e.source="mapbox-gl-draw-hot",t.push(JSON.parse(JSON.stringify(e))),e.id=o+".cold",e.source="mapbox-gl-draw-cold",t.push(JSON.parse(JSON.stringify(e)))}return t},[]),t}},{"./lib/theme":23,hat:2}],34:[function(t,e,o){"use strict";var r=t("turf-envelope"),n=t("turf-centroid");e.exports=function(){var t=this,e=this.ctx.map&&void 0!==this.ctx.map.getSource("mapbox-gl-draw-hot");if(e){var o=this.ctx.events.currentModeName();this.ctx.ui.setClass({mode:o});var i={hot:[],cold:[]},a=this.isDirty,s={},u=function(e){var o=e.properties;"too-small"===o.meta&&(e.geometry=o.point.geometry),delete o.point,e.properties=o;var r=o.id+"."+o.parent+"."+o.coord_path+"."+("too-small"===o.meta?"feature":o.meta),n=JSON.stringify(e),u=t.renderHistory[r];void 0===u&&(u={changed:4});var c={value:n,changed:u.changed};u.value!==n&&c.changed<4?c.changed++:u.value===n&&c.changed>0&&c.changed--,c.changed<2?(i.cold.push(e),a=a?!0:c.changed!==u.changed):(a=a?!0:u.changed<2,i.hot.push(e)),s[r]=c},c=[];this.featureIds.forEach(function(e){var i=t.features[e],a=i.internal(o),s=JSON.stringify(a.geometry.coordinates);if(i.isValid()&&t.ctx.store.needsUpdate(i.toGeoJSON())&&(t.featureHistory[e]=s,c.push(i.toGeoJSON())),"Point"!==a.geometry.type&&t.features[e].isValid()){var l=r({type:"FeatureCollection",features:[a]}),p=l.geometry.coordinates[0][0],d=l.geometry.coordinates[0][2],f=t.ctx.map.project({
lng:p[0],lat:p[1]}),h=t.ctx.map.project({lng:d[0],lat:d[1]}),y=Math.abs(f.x-h.x),m=Math.abs(f.y-h.y),g=Math.pow(y*y+m*m,.5);10>g&&(a.properties.meta="too-small",a.properties.bounds=JSON.stringify([p,d]),a.properties.point=n({type:"FeatureCollection",features:[a]}))}t.ctx.events.currentModeRender(a,u)}),this.renderHistory=s,a&&this.ctx.map.getSource("mapbox-gl-draw-cold").setData({type:"FeatureCollection",features:i.cold}),this.ctx.map.getSource("mapbox-gl-draw-hot").setData({type:"FeatureCollection",features:i.hot}),c.length&&this.ctx.map.fire("draw.changed",{features:c})}this.isDirty=!1,this.zoomRender=this.zoomLevel}},{"turf-centroid":4,"turf-envelope":7}],35:[function(t,e,o){"use strict";var r=t("./events"),n=t("./store"),i=t("./ui");e.exports=function(t){t.events=r(t),t.map=null,t.container=null,t.store=null,i(t);var e={addTo:function(o){return t.map=o,e.onAdd(o),this},remove:function(){return e.removeLayers(),t.ui.removeButtons(),t.events.removeEventListeners(),t.map=null,t.container=null,t.store=null,this},onAdd:function(o){t.container=o.getContainer(),t.store=new n(t),t.ui.addButtons(),o.style.loaded()?(t.events.addEventListeners(),e.addLayers()):o.on("load",function(){t.events.addEventListeners(),e.addLayers()})},addLayers:function(){t.map.addSource("mapbox-gl-draw-cold",{data:{type:"FeatureCollection",features:[]},type:"geojson"}),t.map.addSource("mapbox-gl-draw-hot",{data:{type:"FeatureCollection",features:[]},type:"geojson"}),t.options.styles.forEach(function(e){t.map.addLayer(e)}),t.store.render()},removeLayers:function(){t.options.styles.forEach(function(e){t.map.removeLayer(e.id)}),t.map.removeSource("mapbox-gl-draw-cold"),t.map.removeSource("mapbox-gl-draw-hot")}};return e}},{"./events":13,"./store":36,"./ui":37}],36:[function(t,e,o){"use strict";var r=t("./lib/util"),n=r.throttle,i=t("./render"),a=e.exports=function(t){this.ctx=t,this.features={},this.featureIds=[],this.renderHistory={},this.featureHistory={},this.render=n(i,16,this),this.isDirty=!1,this.zoomLevel=t.map.getZoom(),this.zoomRender=this.zoomLevel};a.prototype.needsUpdate=function(t){var e=this.features[t.id],o=JSON.stringify(t.geometry.coordinates);return!(e&&this.featureHistory[t.id]===o)},a.prototype.setDirty=function(){this.isDirty=!0},a.prototype.changeZoom=function(){this.zoomLevel=this.ctx.map.getZoom(),Math.abs(this.zoomRender-this.zoomLevel)>1&&this.render()},a.prototype.add=function(t){return this.features[t.id]=t,-1===this.featureIds.indexOf(t.id)&&this.featureIds.push(t.id),t.id},a.prototype.get=function(t){return this.features[t]},a.prototype.getAll=function(){var t=this;return Object.keys(this.features).map(function(e){return t.features[e]})},a.prototype["delete"]=function(t){var e=this,o=[];t.forEach(function(t){var r=e.featureIds.indexOf(t);if(-1!==r){var n=e.get(t);o.push(n.toGeoJSON()),delete e.features[t],delete e.featureHistory[t],e.featureIds.splice(r,1)}}),o.length>0&&this.ctx.map.fire("draw.deleted",o)}},{"./lib/util":27,"./render":34}],37:[function(t,e,o){"use strict";var r=t("./lib/types"),n=t("./lib/util"),i=n.createButton;e.exports=function(t){var e={},o={mode:null,feature:null,mouse:null},n={mode:null,feature:null,mouse:null},a=!1,s=["mode","feature","mouse"];window.usedClasses={},requestAnimationFrame(function u(){if(t.container){if(a){var e=[],r=[],i=[];n.feature="none"===n.mouse?null:n.feature,s.forEach(function(t){i.push(t+"-"+n[t]),n[t]!==o[t]&&(e.push(t+"-"+o[t]),null!==n[t]&&r.push(t+"-"+n[t]))}),window.usedClasses[i.join(",")]=!0,e.length&&(t.container.classList.remove.apply(t.container.classList,e),t.container.classList.add.apply(t.container.classList,r)),s.forEach(function(t){o[t]=n[t]}),a=!1}requestAnimationFrame(u)}}),t.ui={setClass:function(t){s.forEach(function(e){t[e]&&(n[e]=t[e],n[e]!==o[e]&&(a=!0))})},addButtons:function(){var o="mapbox-gl-draw_ctrl-draw-btn",n=t.options.controls,a="mapboxgl-ctrl-";switch(t.options.position){case"top-left":case"top-right":case"bottom-left":case"bottom-right":a+=t.options.position;break;default:a+="top-left"}var s=t.container.getElementsByClassName(a)[0],u=s.getElementsByClassName("mapboxgl-ctrl-group")[0];if(!u){u=document.createElement("div"),u.className="mapboxgl-ctrl-group mapboxgl-ctrl";var c=s.getElementsByClassName("mapboxgl-ctrl-attrib")[0];c?s.insertBefore(u,c):s.appendChild(u)}n.line_string&&(e[r.LINE]=i(u,{className:o+" mapbox-gl-draw_line",title:"LineString tool "+(t.options.keybindings&&"(l)"),fn:function(){return t.api.changeMode("draw_line_string")}},o)),n[r.POLYGON]&&(e[r.POLYGON]=i(u,{className:o+" mapbox-gl-draw_polygon",title:"Polygon tool "+(t.options.keybindings&&"(p)"),fn:function(){return t.api.changeMode("draw_polygon")}},o)),n[r.POINT]&&(e[r.POINT]=i(u,{className:o+" mapbox-gl-draw_point",title:"Marker tool "+(t.options.keybindings&&"(m)"),fn:function(){return t.api.changeMode("draw_point")}},o)),n.trash&&(e.trash=i(u,{className:o+" mapbox-gl-draw_trash",title:"delete",fn:function(){t.api.trash(),t.ui.setButtonInactive("trash")}},o))},setButtonActive:function(t){e[t]&&"trash"!==t&&e[t].classList.add("active")},setButtonInactive:function(t){e[t]&&e[t].classList.remove("active")},setAllInactive:function(){var t=Object.keys(e);t.forEach(function(t){if("trash"!==t){var o=e[t];o.classList.remove("active")}})},removeButtons:function(){var t=Object.keys(e);t.forEach(function(t){var o=e[t];o.parentNode&&o.parentNode.removeChild(o),e[t]=null})}}}},{"./lib/types":26,"./lib/util":27}]},{},[1]);
